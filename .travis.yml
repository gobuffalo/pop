language: go

dist: trusty

sudo: required

go:
  - 1.8
  - 1.9
  - "1.10"
  - tip

install:
  - go get -t -v ./...

before_script:
  - go get -u github.com/alecthomas/gometalinter
  - gometalinter --install
  - go build -v -tags sqlite -o tsoda ./soda
  - if [[ "$SODA_DIALECT" == "mysql" ]]; then ./tsoda create -e "mysql_travis"; fi
  - if [[ "$SODA_DIALECT" == "postgres" ]]; then ./tsoda create -e "postgres"; fi
  - if [[ "$SODA_DIALECT" == "sqlite" ]]; then ./tsoda create -e "sqlite"; fi
  - if [[ "$SODA_DIALECT" == "mysql" ]]; then ./tsoda migrate -e "mysql_travis"; fi
  - if [[ "$SODA_DIALECT" == "postgres" ]]; then ./tsoda migrate -e "postgres"; fi
  - if [[ "$SODA_DIALECT" == "sqlite" ]]; then ./tsoda migrate -e "sqlite"; fi

script:
#  - gometalinter --vendor --deadline=5m ./...
  - go test -tags sqlite ./... -v

global_env:
  - MYSQL_USER="travis"
  - MYSQL_PASSWORD=""
  - POSTGRES_PASSWORD=""

env:
  - SODA_DIALECT="postgres"
  - SODA_DIALECT="mysql_travis"
  - SODA_DIALECT="sqlite"

services:
  - mysql

addons:
  postgresql: "9.5"
  apt:
    sources:
      - mysql-5.7-trusty
    packages:
      - mysql-server

matrix:
  allow_failures:
    - go: 'tip'
